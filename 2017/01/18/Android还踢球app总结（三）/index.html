<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android还踢球app总结（三） | Htxf-fxtH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这一篇介绍一下用到的开发模式。做这款软件时对于Android开发的了解仅仅只是看了郭霖大神的《第一行代码》，对于开发模式，或者说软件架构什么的都不了解。不过之前帮一个老师做类似校园BBS时，听他介绍过MVC，自己也查过一些关于MVC的资料。其目的是为了让各个模块儿互相更独立，高内聚低耦合。而M(Model)模型、V(View)视图、C(Controller)控制器，应该是数据访问、界面展示、业务逻">
<meta property="og:type" content="article">
<meta property="og:title" content="Android还踢球app总结（三）">
<meta property="og:url" content="http://yoursite.com/2017/01/18/Android还踢球app总结（三）/index.html">
<meta property="og:site_name" content="Htxf-fxtH">
<meta property="og:description" content="这一篇介绍一下用到的开发模式。做这款软件时对于Android开发的了解仅仅只是看了郭霖大神的《第一行代码》，对于开发模式，或者说软件架构什么的都不了解。不过之前帮一个老师做类似校园BBS时，听他介绍过MVC，自己也查过一些关于MVC的资料。其目的是为了让各个模块儿互相更独立，高内聚低耦合。而M(Model)模型、V(View)视图、C(Controller)控制器，应该是数据访问、界面展示、业务逻">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\login-classes.png">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\class diagram relations.png">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\module package.PNG">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\findallgames pakage.PNG">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\findallgames class.PNG">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\find all games interface.jpg">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\find all games class diagram.jpg">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\lauch a game class.png">
<meta property="og:image" content="http://yoursite.com/..\Android还踢球app总结（三）\a game details.png">
<meta property="og:updated_time" content="2017-08-31T07:20:50.762Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android还踢球app总结（三）">
<meta name="twitter:description" content="这一篇介绍一下用到的开发模式。做这款软件时对于Android开发的了解仅仅只是看了郭霖大神的《第一行代码》，对于开发模式，或者说软件架构什么的都不了解。不过之前帮一个老师做类似校园BBS时，听他介绍过MVC，自己也查过一些关于MVC的资料。其目的是为了让各个模块儿互相更独立，高内聚低耦合。而M(Model)模型、V(View)视图、C(Controller)控制器，应该是数据访问、界面展示、业务逻">
<meta name="twitter:image" content="http://yoursite.com/..\Android还踢球app总结（三）\login-classes.png">
  
    <link rel="alternative" href="/atom.xml" title="Htxf-fxtH" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans|">
  <link href='https://fonts.googleapis.com/css?family=Dancing+Script' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Shadows+Into+Light' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/style.css">
  

  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/iconfont.css">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/animate.css">
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script type="text/javascript" src="http://code.jQuery.com/jquery-latest.js"></script>
  <script src="/js/base.js"></script>
  <script src="/js/jquery.cookie.js"></script>
  <script src="/fancybox/jquery.fancybox.js"></script>
  <script type="text/x-mathjax-config"> 
MathJax.Hub.Config({ 
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} 
}); 
</script>
<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

</head>



<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
    <div id="insert" class="home_logo"></div>
    <div class="hamburger animated shake">
      <i ></i>
      <ul>
        <li class="home"><a href="/">Home<span></span></a></li>
        <li><a href="http://cpbxx.lofter.com/" target="_blank">Works<span></span></a></li>
        <!-- 这是最开始的时候 -->
        <!-- <li class="home_notes_showon" ><a href="/">Notes<span></span></a></li> -->
        <!-- 换成了带有类别的note或者tucao -->
        <li class="home_notes_showon" ><a href="/categories/note">Notes<span></span></a></li>
        <li class="home_tucaos_showon" ><a href="/categories/tucao">Tucaos<span></span></a></li>
        <li><a href="/resume">Resume<span></span></a></li>
      </ul>
    </div>
</header>


<!-- 

    <a class="main-nav-link" href="/">Home</a>

    <a class="main-nav-link" href="/archives">Archives</a>

    <a class="main-nav-link" href="/categories/note">Notes</a>

    <a class="main-nav-link" href="/resume">Resume</a>

    <a class="main-nav-link" href="/categories/tucao">Tucaos</a>
 
-->
      <div class="outer">
        <section id="main"><div class="main_center"><article id="post-Android还踢球app总结（三）" class="article article-type-post" itemscope itemprop="blogPost">

  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android还踢球app总结（三）
    </h1>
  


        <div class="article-meta">
          <span class="article-date">
  <time datetime="2017-01-18T07:17:13.000Z" itemprop="datePublished">Jan 18 2017</time>
</span>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这一篇介绍一下用到的开发模式。做这款软件时对于Android开发的了解仅仅只是看了郭霖大神的《第一行代码》，对于开发模式，或者说软件架构什么的都不了解。不过之前帮一个老师做类似校园BBS时，听他介绍过MVC，自己也查过一些关于MVC的资料。其目的是为了让各个模块儿互相更独立，高内聚低耦合。而<strong>M(Model)模型</strong>、<strong>V(View)视图</strong>、<strong>C(Controller)控制器</strong>，应该是<strong>数据访问</strong>、<strong>界面展示</strong>、<strong>业务逻辑</strong>三者的对应，正是一个软件不可少的东西。</p>
<h3 id="1-预备知识"><a href="#1-预备知识" class="headerlink" title="1. 预备知识"></a>1. 预备知识</h3><p>在敲代码之前，是先做了一些功能模块的划分，再做了UI，然后就在想用什么方式组织代码，可以提高效率。同时也在想如果是在公司做的话，会用什么方式分配这些不同模块、不同功能的代码任务。之后就在网上查到了应用于Android的MVP模式。它其实是从MVC模式演化而来。</p>
<blockquote>
<p>在Android中Activity或者Fragment是用来做界面展示的，但是其生命周期对于整个软件是很关键的，所以会将一些业务逻辑写在Activity中，这样做很直观，但是其代价就是Activity会越来越臃肿……</p>
</blockquote>
<a id="more"></a>
<p>Android的MVP中<strong>V(View)</strong>就是Activity或者Fragment，<strong>P(Presenter)</strong>相当于MVC中的控制器，<strong>M(Model)</strong>就是MVC中的Model，但<strong>M(Model)</strong>和<strong>V(View)</strong>是完全解耦的，它们之间要打交道的话都要通过<strong>P(Presenter)</strong>。MVP和MVC的区别，一个是M和V更加独立，另一个是将MVP三者都先抽象成了接口，再用具体的类是实现。（第二点，感觉MVC也可以这样做？？或者这种东西其实不是很死板的，适合的才是最好的。）</p>
<p>看了很多资料，直到看到下面这张图，整个思路才算理清。(但是找不到真正的出处是哪儿的了……)</p>
<p><img src="..\Android还踢球app总结（三）\login-classes.png" width="100%" height="100%"></p>
<p>在上图中，首先是有<em>LoginView</em>、<em>LoginPresenter</em>、<em>LoginInteractor</em>三个接口，对应上边的<strong>V</strong>、<strong>P</strong>、<strong>M</strong>。V获得账号密码，传递给P，P再传递给M，M验证之后通过<em>OnLoginFinishedListener</em>接口告知P结果，最后P再根据结果告诉V做什么。</p>
<p>LoginActiviy类实现了<em>LoginView</em>接口、LoginPresenterImp类实现了<em>LoginPresenter</em>接口和<em>OnLoginFinishedListener</em>接口、LoginInteractor类实现了<em>LoginIteractor</em>接口。LoginActivity中持有LoginPresenter的引用(其实是LoginPresenterImp)，而LoginPresenterImp中持有LoginView(其实是LoginActivity)和LoginInteractor(其实是LoginInteractorImp)的引用，这样就能实现信息的传递，而LoginInteractor(其实是LoginInteractorImp)中的消息是通过监听器传给LoginPresenterImp的。</p>
<p>再介绍下UML类图中的关系，三角形箭头虚线箭身是具体的类实现接口，实线箭头是关联，虚线箭头是依赖。</p>
<p><img src="..\Android还踢球app总结（三）\class diagram relations.png"></p>
<p><a href="http://www.cnblogs.com/liuzhang/archive/2013/03/17/2964095.html" target="_blank" rel="external">这篇文章</a>有介绍关联和依赖之间的区别。简单点说就是以依赖关系更弱，关联关系更强。像上图中的LoginPresenterImp中持有LoginInteractor的引用，两者关系强，是关联；而LoginInteractor只是其中一个方法用到了OnLoginFinishedListener做参数，两者关系弱，是依赖。</p>
<h3 id="2-还踢球app"><a href="#2-还踢球app" class="headerlink" title="2. 还踢球app"></a>2. 还踢球app</h3><p>本软件就是完全按照上边那张图进行MVP的使用。还有一个问题，是应该按照不同的功能模块儿打包还是按照MVP这三者进行打包。网上两种方式都有使用者。我先按照功能模块建了包，然后再在里边按照MVP建了包，这样虽然层级深了，但感觉组织性更强了。</p>
<p><img src="..\Android还踢球app总结（三）\module package.PNG"></p>
<p>在找组织模块中，有一个entity包，还有三个子功能包，其中每个子功能包中都有三个包：Model、View和Presenter。本来觉得Java Bean 实体类应该算在Model中，但后来想比如entity中的Post类，有一些属性还有get、set方法，这些在每个子功能中都会用到，不知道该放到哪个里边。所以还不如这样，将所有的实体类放到一个包中，是其他类公用的，至于子功能中的Model就是单单做数据的访问，比如查询、添加等等。</p>
<p><img src="..\Android还踢球app总结（三）\findallgames pakage.PNG"></p>
<p>其他两个功能模块的代码组织和找组织功能一样，这里就不在叙述。</p>
<h3 id="3-找组织功能模块"><a href="#3-找组织功能模块" class="headerlink" title="3. 找组织功能模块"></a>3. 找组织功能模块</h3><p>本小节详细介绍下找组织功能的MVP模式的设计，以及实际的流程。其他两个功能模块大同小异。其模块中具体的类如下图所示。</p>
<p><img src="..\Android还踢球app总结（三）\findallgames class.PNG"></p>
<p>首先，有三个接口(interface)分别对应MVP。<em>AllPostsModel</em>—M、<em>AllPostsView</em>—V、<em>AllPostsPresenter</em>—P。还有一个<em>OnAllPostsListener</em>接口，是M(AllPostsModel)用来通知P(AllPostsPresenter)查询结果的。</p>
<p><img src="..\Android还踢球app总结（三）\find all games interface.jpg"></p>
<p>接下来，分别实现了各个接口。AllPostsFragment类实现AllPostsView接口（这里使用的Fragment做View，就是上一节介绍的ViewPager结合Fragment做tabs）、AllPostsPresenterImp类实现AllPostsPresenter接口和OnAllPostsListenter接口、AllPostsModelImp类实现AllPostsModel接口。</p>
<p>在AllPostsFragment中持有AllPostsPresenter的引用，在AllPostsPresenterImp中持有AllPostsView和AllPostsModel的引用。</p>
<p>打开软件，要执行AllPostsFragment中的onCreateView方法，在这个方法中，首先获取了AllPostsPresenter的引用，然后调用了该类中的getAllPosts方法，还有一些其他关于Fragment和其空间的初始化操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">     <span class="comment">// 实现对AllPostsPresenterImp的引用</span></div><div class="line">    mAllPostsPresenter = <span class="keyword">new</span> AllPostsPresenterImp(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// 调用AllPostsPresenterImp中的getAllPosts方法</span></div><div class="line">    mAllPostsPresenter.getAllPosts();</div><div class="line">     ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>AllPostsPresenterImp中的getAllPosts方法会调用AllPostsModel中的loadAllPosts方法。其中有一个参数，需要传入OnAllPostsListener，因为AllPostsPresenterImp实现了OnAllPostsListener，所以就传入this。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAllPosts</span><span class="params">()</span></span>&#123;</div><div class="line">    mAllPostsView.showLoading();</div><div class="line">    <span class="comment">// 调用AllPostsModelImp中的loadAllPosts方法</span></div><div class="line">    mAllPostsModel.loadAllPosts(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在AllPostsModelImp的loadAllPosts方法中，根据现在的日期时间，去Bmob服务器上查询约球时间在当前时刻之后的帖子。然后将查询结果通过OnAllPostsListener告知给AllPostsPresenterImp。（若是成功，就将排好序的Post是放入List中，传递给OnAllPostsListener的onSuccess方法）其中有两处对所查询的帖子进行排序，query.order(“dateTime”)和Collections.sort(…)，应该是query.order()不顶用，才又使用了Collections.sort()？？？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadAllPosts</span><span class="params">(<span class="keyword">final</span> OnAllPostsListener listener)</span></span>&#123;</div><div class="line">    <span class="comment">// 获取当前的时间，并转化为 yyyy-MM-dd HH:mm:ss的格式</span></div><div class="line">    Calendar calendar=Calendar.getInstance();</div><div class="line">    calendar.setTime(<span class="keyword">new</span> Date());</div><div class="line">    String startDate =String.valueOf(calendar.get(Calendar.YEAR))+<span class="string">"-"</span>+</div><div class="line">            <span class="comment">// 月份要加一</span></div><div class="line">            String.valueOf(calendar.get(Calendar.MONTH)+<span class="number">1</span>)+<span class="string">"-"</span>+</div><div class="line">            String.valueOf(calendar.get(Calendar.DAY_OF_MONTH))+<span class="string">" "</span>+</div><div class="line">            String.valueOf(calendar.get(Calendar.HOUR_OF_DAY))+<span class="string">":"</span>+</div><div class="line">            String.valueOf(calendar.get(Calendar.MINUTE))+<span class="string">":"</span>+<span class="string">"00"</span>;</div><div class="line">    SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</div><div class="line">    Date date  = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        date = sdf.parse(startDate);</div><div class="line">    &#125; <span class="keyword">catch</span> (ParseException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Bmob实现查询</span></div><div class="line">    BmobQuery&lt;Post&gt; query = <span class="keyword">new</span> BmobQuery&lt;&gt;();</div><div class="line">    <span class="comment">// 查询约球时间在当前时刻之后的帖子</span></div><div class="line">    query.addWhereGreaterThanOrEqualTo(<span class="string">"dateTime"</span>,<span class="keyword">new</span> BmobDate(date));</div><div class="line">    query.order(<span class="string">"dateTime"</span>);</div><div class="line">    query.findObjects(ContextHolder.getContext(), <span class="keyword">new</span> FindListener&lt;Post&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;Post&gt; object)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">            <span class="keyword">if</span> (object.size() != <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">// 返回的是一个Post的List，对其按照约球时间进行排顺序。</span></div><div class="line">                Collections.sort(object, <span class="keyword">new</span> Comparator&lt;Post&gt;() &#123;</div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Post arg0, Post arg1)</span> </span>&#123;</div><div class="line">                        <span class="keyword">return</span> arg0.getDate().compareTo(arg1.getDate());</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line"></div><div class="line">                listener.onSuccess(object);</div><div class="line"></div><div class="line">                postList = object;</div><div class="line"></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                Toast.makeText(ContextHolder.getContext(), <span class="string">"还没有约球组织"</span>, Toast.LENGTH_LONG).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(<span class="keyword">int</span> code, String msg)</span> </span>&#123;</div><div class="line">            <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">            listener.onError(msg);</div><div class="line">            Toast.makeText(ContextHolder.getContext(), msg + <span class="string">" "</span> + code, Toast.LENGTH_LONG).show();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>AllPostsPresenterImp实现了OnAllPostsListener接口，其在onSuccess方法中调用了AllPostsView的setAllPosts方法。将查询到的Post的List传递过去。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(List&lt;Post&gt; objects)</span></span>&#123;</div><div class="line">    mAllPostsView.hideLoading();</div><div class="line">    mAllPostsView.setAllPosts(objects);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>AllPostsFragment的中的setAllPosts方法就是把查询到的Post的List通过RecycleView的Adapter的构造函数传递过去。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAllPosts</span><span class="params">(List&lt;Post&gt; objects)</span></span>&#123;</div><div class="line">    mRecyclerView.setAdapter(<span class="keyword">new</span> AllPostsRecyclerViewAdapter(getActivity(),objects));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样一次查询就算是走了一遍。其实整个过程和之前的例子是一模一样的。类图如下所示。</p>
<p><img src="..\Android还踢球app总结（三）\find all games class diagram.jpg"></p>
<h3 id="4-其他功能模块"><a href="#4-其他功能模块" class="headerlink" title="4. 其他功能模块"></a>4. 其他功能模块</h3><p>发起组织功能模块中类图如下图所示。</p>
<p><img src="..\Android还踢球app总结（三）\lauch a game class.png"></p>
<p>查询一个帖子详情功能的类图如下所示。</p>
<p><img src="..\Android还踢球app总结（三）\a game details.png"></p>
<p>这两者的设计、运行过程和找组织功能都一样，就不再详细叙述了。</p>

      
    </div>
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>


    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/02/22/JS高程（四）/" id="article-nav-newer" class="article-nav-link-wrap">WEI</a>
  
  
    <a href="/2017/01/03/Android还踢球app总结（二）/" id="article-nav-older" class="article-nav-link-wrap">ALI</a>
  
</nav>


  
</article>


</div>
</section>
      </div>
    </div>
  </div>
</body>
</html>
